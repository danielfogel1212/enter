<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ימי השבוע</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            direction: rtl;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        nav {
            background-color: #343a40;
        }

        nav a {
            color: #fff !important;
        }

        .container {
            margin-top: 20px;
        }

        h2 {
            text-align: center;
            color: #343a40;
        }

        .week-navigation {
            text-align: center;
            margin-bottom: 20px;
        }

        .date-navigation a {
            display: inline-block;
            padding: 8px 16px;
            margin: 0 10px;
            text-decoration: none;
            color: #fff;
            background-color: #007BFF;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        .date-navigation a i {
            margin-right: 5px;
        }

        .table-responsive {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 15px;
            text-align: center;
        }

        thead {
            background-color: #007BFF;
            color: #fff;
        }

        tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .btn-primary {
            background-color: #007BFF;
            border: none;
        }

        .btn-primary:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body style="direction: rtl; text-align: right;">

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="index.html">בית</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link"  id = "name" href="#my-shifts"></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="logout.html">יציאה</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<main class="container">
    <section>
        <h2>ימי השבוע בעברית</h2>
        <div class="week-navigation">
            <div class="current-date"></div>
            <div class="date-navigation">
                <a href="#" class="previous-week" id="less"><i class="fas fa-arrow-right"></i> שבוע קודם</a>
                <a href="#" class="next-week" id="next">שבוע הבא <i class="fas fa-arrow-left"></i></a>
            </div>
        </div>
        <div class="table-responsive">
            <center>
                <span id="dateRange"></span>
            </center>
            
            <form method="post" id="login-form">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th></th>
                            <th>ראשון</th>
                            <th>שני</th>
                            <th>שלישי</th>
                            <th>רביעי</th>
                            <th>חמישי</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>בוקר</td>
                          
                            <td id="morning">
                               
                       
                            
                            
                        </td>
                        <input type="hidden" id ="sundayID" name="sundayID" value="">
                        <td id="morning1">  
                            
                    </td>
                    
                    <input type="hidden" id ="mondayID" name="mondayID" value="">
                    <td id="morning3">
                   
         
                </td>
                <input type="hidden" id ="tuesdayID" name="tuesdayID" value="">
                <td id="morning4">
                
             
                
       
            </td>
            <input type="hidden" id ="wednesdayID" name="wednesdayID" value="">
            <td id="morning5">
          
              
          
        </td>
          
        <input type="hidden" id ="thursdayID" name="thursdayID" value="">
                  </tr>
                  
                        <tr>
                            <td>צהריים</td>
                            <td id="lunch">
                                
                                
                            </td>
                            <input type="hidden" id ="sundayIDl" name="sundayIDl" value="">
                            <td id="lunch1">
                                
                            </td>
                            <input type="hidden" id ="mondayIDl" name="mondayIDl" value="">
                            <td id="lunch3">
                              
                      

                            </td>
                            <input type="hidden" id ="tuesdayIDl" name="wednesdayIDl" value="">
                            <td id="lunch4">
                               
                              
                            </td>
                            <input type="hidden" id ="wednesdayIDl" name="wednesdayIDl" value="">
                            <td id="lunch5">
                                

                            </td>
                            <input type="hidden" id ="thursdayIDl" name="thursdayIDl" value="">

                          
                           
                        </tr>
                    </tbody>
                </table>
                <center>
    
                </center>
            </form>
        </div>
    </section>
</main>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>
<!-- Your existing HTML code -->

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>
<script>



  async function all() {
    const accessToken = sessionStorage.getItem('access_token');

    const response = await fetch('http://127.0.0.1:5000/allsh', {
        method: 'POST',
        headers: {
            'Authorization': `Bearer ${accessToken}`
        },
    });

    if (response.ok) {
        const data = await response.json();

        for (var x in data) {
            if ((document.getElementById("sundayID").value == data[x]['day']) && (data[x]['morning'] == "משרד" || data[x]['morning'] == "בית")) {
                document.getElementById("morning").innerHTML +="<p>"+data[x]['username'];
            }
        }

        for (var x in data) {
            if ((document.getElementById("mondayID").value == data[x]['day']) && (data[x]['morning'] == "משרד" || data[x]['morning'] == "בית")) {
                document.getElementById("morning1").innerHTML +="<p>"+ data[x]['username'];
            }
        }

        for (var x in data) {
            if ((document.getElementById("tuesdayID").value == data[x]['day']) && (data[x]['morning'] == "משרד" || data[x]['morning'] == "בית")) {
                document.getElementById("morning3").innerHTML +="<p>"+ data[x]['username'];
            }
        }

        for (var x in data) {
            if (document.getElementById("wednesdayID").value == data[x]['day'] && (data[x]['morning'] == "משרד" || data[x]['morning'] == "בית")) {
                document.getElementById("morning4").innerHTML  +="<p>"+ data[x]['username'];
            }
        }

        for (var x in data) {
            if (document.getElementById("thursdayID").value == data[x]['day'] && (data[x]['morning'] == "משרד" || data[x]['morning'] == "בית")) {
                
                document.getElementById("morning5").innerHTML  +="<p>"+ data[x]['username'];
            }
        }
        for (var x in data) {
            if (document.getElementById("sundayIDl").value == data[x]['day'] && (data[x]['lunch'] == "משרד" || data[x]['lunch'] == "בית")) {
                document.getElementById("lunch").innerHTML  +="<p>"+data[x]['username'];
            }
        }

        for (var x in data) {
            if (document.getElementById("mondayIDl").value == data[x]['day'] && (data[x]['lunch'] == "משרד" || data[x]['lunch'] == "בית")) {
                document.getElementById("lunch1").innerHTML  +="<p>"+ data[x]['username'];
            }
        }

        for (var x in data) {
            if (document.getElementById("tuesdayIDl").value == data[x]['day'] && (data[x]['morning'] == "lunch" || data[x]['lunch'] == "בית")) {
                document.getElementById("lunch3").innerHTML  +="<p>"+ data[x]['username'];
            }
        }

        for (var x in data) {
            if (document.getElementById("wednesdayIDl").value == data[x]['day'] && (data[x]['lunch'] == "משרד" || data[x]['lunch'] == "בית")) {
                document.getElementById("lunch4").innerHTML  +="<p>"+ data[x]['username'];
            }
        }

        for (var x in data) {
            if (document.getElementById("thursdayIDl").value == data[x]['day'] && (data[x]['lunch'] == "משרד" || data[x]['lunch'] == "בית")) {
                console.log(data[x]['morning']);
                document.getElementById("lunch5").innerHTML  +="<p>"+ data[x]['username'];
            }
        }

    }
}
all()
async function edit(event) {
const accessToken = sessionStorage.getItem('access_token');
event.preventDefault();
const form = document.getElementById('login-form');

const formData = new FormData(form);

try {
const response = await fetch('http://127.0.0.1:5000/shift', {
    method: 'POST',
    headers: {
        'Authorization': `Bearer ${accessToken}`,
    },
    body: formData,
});

if (response.ok) {
    // Request was successful (status code 2xx)
    console.log("updated")
const data = await response.json();

// for (var x in data) {
   
//         document.getElementById("morning").value = data[x]['morning'];
// }
    // You can also display a message to the user if needed
} 

// Rest of your code handling the response...
} catch (error) {
console.error('Error:', error);
// Handle error as needed...
}
}
    document.addEventListener('DOMContentLoaded', function () {
        var currentDate = new Date(); // Get the current date
        var startDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate());
        var endDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate() + 5); // Assuming a week-long range

        updateDateRange();
     
        // Add event listeners to the previous and next week buttons
        document.getElementById('less').addEventListener('click', function () {
            clearTable(); // Clear the table values
            startDate.setDate(startDate.getDate() - 7);
            endDate.setDate(endDate.getDate() - 7);
            document.getElementById("sundayID").value = startDate.getDate();
document.getElementById("mondayID").value = startDate.getDate() + 1;
document.getElementById("tuesdayID").value = startDate.getDate() + 2;
document.getElementById("wednesdayID").value = startDate.getDate() + 3;
document.getElementById("thursdayID").value = startDate.getDate() + 4;


// If you want to display the full date including the year:
document.getElementById("sundayID").value += '/' + (startDate.getMonth() + 1) + '/' + startDate.getFullYear();
document.getElementById("mondayID").value += '/' + (startDate.getMonth() + 1) + '/' + startDate.getFullYear();
document.getElementById("tuesdayID").value += '/' + (startDate.getMonth() + 1) + '/' + startDate.getFullYear();
document.getElementById("wednesdayID").value += '/' + (startDate.getMonth() + 1) + '/' + startDate.getFullYear();
document.getElementById("thursdayID").value += '/' + (startDate.getMonth() + 1) + '/' + startDate.getFullYear();


document.getElementById("sundayIDl").value = startDate.getDate();
document.getElementById("sundayIDl").value += '/' + (startDate.getMonth() + 1) + '/' + startDate.getFullYear();


document.getElementById("mondayIDl").value = startDate.getDate() +1
document.getElementById("mondayIDl").value += '/' + (startDate.getMonth() + 1) + '/' + startDate.getFullYear();

document.getElementById("tuesdayIDl").value = startDate.getDate() +2
document.getElementById("tuesdayIDl").value += '/' + (startDate.getMonth() + 1) + '/' + startDate.getFullYear();

document.getElementById("wednesdayIDl").value = startDate.getDate() +3
document.getElementById("wednesdayIDl").value += '/' + (startDate.getMonth() + 1) + '/' + startDate.getFullYear();

document.getElementById("thursdayIDl").value = startDate.getDate() +4
document.getElementById("thursdayIDl").value += '/' + (startDate.getMonth() + 1) + '/' + startDate.getFullYear();
            updateDateRange();
            populateTable();
            all()
        });
        var startDate = new Date();
        document.getElementById("sundayID").value = startDate.getDate();
document.getElementById("mondayID").value = startDate.getDate() + 1;
document.getElementById("tuesdayID").value = startDate.getDate() + 2;
document.getElementById("wednesdayID").value = startDate.getDate() + 3;
document.getElementById("thursdayID").value = startDate.getDate() + 4;

document.getElementById("sundayIDl").value = startDate.getDate();
// If you want to display the full date including the year:
document.getElementById("sundayID").value += '/' + (startDate.getMonth() + 1) + '/' + startDate.getFullYear();
document.getElementById("mondayID").value += '/' + (startDate.getMonth() + 1) + '/' + startDate.getFullYear();
document.getElementById("tuesdayID").value += '/' + (startDate.getMonth() + 1) + '/' + startDate.getFullYear();
document.getElementById("wednesdayID").value += '/' + (startDate.getMonth() + 1) + '/' + startDate.getFullYear();
document.getElementById("thursdayID").value += '/' + (startDate.getMonth() + 1) + '/' + startDate.getFullYear();



document.getElementById("sundayIDl").value = startDate.getDate();
document.getElementById("sundayIDl").value += '/' + (startDate.getMonth() + 1) + '/' + startDate.getFullYear();
document.getElementById("mondayIDl").value = startDate.getDate()+1
document.getElementById("mondayIDl").value += '/' + (startDate.getMonth() + 1) + '/' + startDate.getFullYear();
document.getElementById("tuesdayIDl").value = startDate.getDate() +2
document.getElementById("tuesdayIDl").value += '/' + (startDate.getMonth() + 1) + '/' + startDate.getFullYear();
document.getElementById("wednesdayIDl").value = startDate.getDate() +3
document.getElementById("wednesdayIDl").value += '/' + (startDate.getMonth() + 1) + '/' + startDate.getFullYear();

document.getElementById("thursdayIDl").value = startDate.getDate() +4
document.getElementById("thursdayIDl").value += '/' + (startDate.getMonth() + 1) + '/' + startDate.getFullYear();



        document.getElementById('next').addEventListener('click', function () {
            clearTable(); // Clear the table values
            startDate.setDate(startDate.getDate() + 7);
            endDate.setDate(endDate.getDate() + 7);
            document.getElementById("sundayID").value = startDate.getDate();
document.getElementById("mondayID").value = startDate.getDate() + 1;
document.getElementById("tuesdayID").value = startDate.getDate() + 2;
document.getElementById("wednesdayID").value = startDate.getDate() + 3;
document.getElementById("thursdayID").value = startDate.getDate() + 4;



// If you want to display the full date including the year:
document.getElementById("sundayID").value += '/' + (startDate.getMonth() + 1) + '/' + startDate.getFullYear();
document.getElementById("mondayID").value += '/' + (startDate.getMonth() + 1) + '/' + startDate.getFullYear();
document.getElementById("tuesdayID").value += '/' + (startDate.getMonth() + 1) + '/' + startDate.getFullYear();
document.getElementById("wednesdayID").value += '/' + (startDate.getMonth() + 1) + '/' + startDate.getFullYear();
document.getElementById("thursdayID").value += '/' + (startDate.getMonth() + 1) + '/' + startDate.getFullYear();


document.getElementById("sundayIDl").value = startDate.getDate();
document.getElementById("sundayIDl").value += '/' + (startDate.getMonth() + 1) + '/' + startDate.getFullYear();
document.getElementById("mondayIDl").value = startDate.getDate()+1
document.getElementById("mondayIDl").value += '/' + (startDate.getMonth() + 1) + '/' + startDate.getFullYear();
document.getElementById("tuesdayIDl").value = startDate.getDate() +2
document.getElementById("tuesdayIDl").value += '/' + (startDate.getMonth() + 1) + '/' + startDate.getFullYear();
document.getElementById("wednesdayIDl").value = startDate.getDate() +3
document.getElementById("wednesdayIDl").value += '/' + (startDate.getMonth() + 1) + '/' + startDate.getFullYear();
document.getElementById("thursdayIDl").value = startDate.getDate() +4
document.getElementById("thursdayIDl").value += '/' + (startDate.getMonth() + 1) + '/' + startDate.getFullYear();
            updateDateRange();
            populateTable();
           all()
        });

        // Function to update the date range span
        function updateDateRange() {
            var dateRange = startDate.toLocaleDateString() + ' - ' + endDate.toLocaleDateString();
            document.getElementById('dateRange').innerText = dateRange;
        }

        // Function to clear the table values
        function clearTable() {
    var tds = document.querySelectorAll('td');
    tds.forEach(function (td) {
        if(td.innerHTML!="בוקר" && td.innerHTML!="צהריים"){

            td.innerHTML = '';
        }

    });
}


        function getDayName(dayIndex) {
            var days = ["ראשון", "שני", "שלישי", "רביעי", "חמישי", "שישי", "שבת"];
            return days[dayIndex];
        }

        function populateTable() {
            var table = document.querySelector('table');
            var currentDate = new Date(startDate);

            // Loop through each row and cell
            for (var i = 1; i < table.rows.length; i++) {
                var row = table.rows[i];
                for (var j = 1; j < row.cells.length; j++) {
                    var cell = row.cells[j];
                    var select = cell.querySelector('td');
                    
 
                    // Set the ID and name attributes
                    var formattedDate = currentDate.toLocaleDateString().replace(/\//g, '-');
                    var fieldID = 'td_' + formattedDate + '_morning_' + i + '_' + j;
                
                    var dayName = getDayName(currentDate.getDay());
       

                    currentDate.setDate(currentDate.getDate() + 1); 
                }
            }
        }


        populateTable();
    });

    async function getName() {
    try {
        const accessToken = sessionStorage.getItem('access_token');
        console.log(accessToken);

        const response = await fetch('http://127.0.0.1:5000/get_name', {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${accessToken}`,
            },
        });

        console.log(response);

        if (response.ok) {
            const data = await response.json();
            console.log('Data retrieved successfully!', data);

            // Check if 'username' property exists in data before updating the element
            if (data.hasOwnProperty('username')) {
                document.getElementById("name").innerHTML = data.username;
            } else {
                console.error('Username not found in the response data.');
            }
        } else if (response.status === 401) {
            console.error('Unauthorized access:', response.status);
         
        } else {
            console.error('Unexpected status code:', response.status);
      
        }
    } catch (error) {
        console.error('Error:', error);
    }
}

// Call the function
getName();

</script>
</body>
</html>

</script>
</body>
</html>
